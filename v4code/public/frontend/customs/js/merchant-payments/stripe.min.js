"use strict";function isNumber(e){e=(e=e||window.event).which||e.keyCode;return!(31<e&&(e<48||57<e))}function makePayment(){return new Promise(function(t,n){var e=$("#cardNumber").val(),a=$("#month").val(),r=$("#year").val(),i=$("#cvc").val(),d=$("#currency").val(),m=$("#merchant").val();$("#stripeError").html(""),e&&a&&r&&i&&$.ajax({type:"POST",url:SITE_URL+"/standard-merchant/stripe-make-payment",data:{_token:token,cardNumber:e,month:a,year:r,cvc:i,currency:d,merchant:m,amount:amount},dataType:"json",beforeSend:function(e){$("#stripeSubmitBtn").attr("disabled",!0)}}).done(function(e){return 200!=e.data.status?($("#stripeError").html(e.data.message),$("#stripeSubmitBtn").attr("disabled",!0),n(e.data.status),!1):($("#stripeSubmitBtn").attr("disabled",!1),void t(e.data))})})}function confirmPayment(){makePayment().then(function(e){var t=$("#stripePaymentForm")[0],t=new FormData(t);t.append("_token",token),t.append("paymentIntendId",e.paymentIntendId),t.append("paymentMethodId",e.paymentMethodId),$.ajax({type:"POST",url:SITE_URL+"/payment/stripe",data:t,processData:!1,contentType:!1,cache:!1,beforeSend:function(e){$("#stripeSubmitBtn").attr("disabled",!0),$(".spinner").removeClass("d-none")}}).done(function(e){return $(".spinner").addClass("d-none"),200!=e.data.status?($("#stripeSubmitBtn").attr("disabled",!0),$("#stripeError").html(e.data.message),!1):void window.location.replace(SITE_URL+"/payment/success")})})}$(document).ready(function(){$("#stripePaymentForm").submit(function(e){e.preventDefault(),$("#stripeSubmitBtn").attr("disabled",!0),$(".spinner").removeClass("d-none"),$("#stripeSubmitBtnText").text(stripeSubmitBtnText),confirmPayment()})}),$("#month").change(function(){makePayment()}),$("#year, #cvc, #cardNumber").on("keyup",$.debounce(1e3,function(){makePayment()})),document.getElementById("cardNumber").addEventListener("input",function(e){var t=e.target,n=t.selectionEnd,e=t.value.length;t.value=t.value.replace(/[^\d]/g,"").replace(/(.{4})/g,"$1 ").trim(),t.selectionEnd=n+=" "===t.value.charAt(n-1)&&" "===t.value.charAt(e-1)&&e!==t.value.length?1:0});